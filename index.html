<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Enterprise AI Workflow Orchestrator - Scalable drag and drop workflow builder." />
<title>Enterprise AI Workflow Orchestrator</title>

<style>
:root {
  --primary: #111827;
  --accent: #2563eb;
  --bg: #f3f4f6;
  --border: #e5e7eb;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--primary);
}

header, footer {
  background: white;
  border-bottom: 1px solid var(--border);
  padding: 1rem 2rem;
}

footer {
  border-top: 1px solid var(--border);
  border-bottom: none;
  text-align: center;
}

h1, h2 {
  margin: 0 0 1rem 0;
}

main {
  padding: 2rem;
}

.builder {
  display: flex;
  height: 600px;
  background: white;
  border: 1px solid var(--border);
}

.sidebar {
  width: 250px;
  border-right: 1px solid var(--border);
  padding: 1rem;
  overflow-y: auto;
}

.sidebar button {
  width: 100%;
  margin-bottom: 0.5rem;
  padding: 0.5rem;
  cursor: pointer;
  border: 1px solid var(--border);
  background: #fff;
}

.sidebar button:hover {
  background: var(--accent);
  color: white;
}

.canvas {
  flex: 1;
  position: relative;
  overflow: hidden;
  background: #fafafa;
}

.node {
  position: absolute;
  width: 150px;
  padding: 10px;
  background: white;
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: grab;
  user-select: none;
}

.node strong {
  display: block;
  margin-bottom: 5px;
}

.controls {
  margin-top: 1rem;
}

.controls button {
  margin-right: 0.5rem;
  padding: 0.5rem 1rem;
}
</style>
</head>

<body>

<header role="banner">
  <h1>Enterprise AI Workflow Orchestrator</h1>
</header>

<main>

<section aria-labelledby="builder-title">
  <h2 id="builder-title">Workflow Builder</h2>

  <div class="builder">

    <aside class="sidebar" aria-label="Node Library">
      <h3>Node Library</h3>
      <div id="nodeLibrary"></div>
    </aside>

    <div class="canvas"
         id="canvas"
         role="region"
         aria-label="Workflow Canvas"
         tabindex="0">
    </div>

  </div>

  <div class="controls">
    <button onclick="executeWorkflow()">Execute Workflow</button>
    <button onclick="saveWorkflow()">Save</button>
    <button onclick="loadWorkflow()">Load</button>
    <button onclick="clearWorkflow()">Clear</button>
  </div>

</section>

</main>

<footer role="contentinfo">
  Â© 2026 Enterprise AI Workflow Orchestrator
</footer>

<script>
/* ==============================
   SIMPLE ZUSTAND-LIKE STORE
================================= */

function createStore(initialState) {
  let state = initialState;
  const listeners = new Set();

  const setState = (partial) => {
    state = { ...state, ...partial };
    listeners.forEach((l) => l(state));
  };

  const getState = () => state;

  const subscribe = (listener) => {
    listeners.add(listener);
    return () => listeners.delete(listener);
  };

  return { setState, getState, subscribe };
}

const store = createStore({
  nodes: []
});

/* ==============================
   PLUGIN SYSTEM
================================= */

class PluginRegistry {
  constructor() {
    this.plugins = new Map();
  }

  register(plugin) {
    this.plugins.set(plugin.type, plugin);
  }

  get(type) {
    return this.plugins.get(type);
  }

  list() {
    return Array.from(this.plugins.values());
  }
}

const registry = new PluginRegistry();

/* ==============================
   SAMPLE NODE TYPES (Extendable)
================================= */

registry.register({
  type: "input",
  label: "Input Node",
  execute: () => ({ output: "User Input" })
});

registry.register({
  type: "ai",
  label: "AI Model Node",
  execute: (input) => ({ output: "AI Processed: " + input })
});

registry.register({
  type: "output",
  label: "Output Node",
  execute: (input) => ({ output: "Final Output: " + input })
});

/* ==============================
   RENDER NODE LIBRARY
================================= */

const library = document.getElementById("nodeLibrary");

registry.list().forEach(plugin => {
  const btn = document.createElement("button");
  btn.textContent = plugin.label;
  btn.onclick = () => addNode(plugin.type);
  library.appendChild(btn);
});

/* ==============================
   ADD NODE
================================= */

const canvas = document.getElementById("canvas");

function addNode(type) {
  const id = crypto.randomUUID();
  const node = { id, type, x: 50, y: 50 };

  store.setState({
    nodes: [...store.getState().nodes, node]
  });

  renderNode(node);
}

/* ==============================
   RENDER NODE
================================= */

function renderNode(node) {
  const div = document.createElement("div");
  div.className = "node";
  div.style.left = node.x + "px";
  div.style.top = node.y + "px";
  div.dataset.id = node.id;

  div.innerHTML = `<strong>${node.type.toUpperCase()}</strong>ID: ${node.id.slice(0,5)}`;

  enableDrag(div);
  canvas.appendChild(div);
}

/* ==============================
   DRAG & DROP SYSTEM
================================= */

function enableDrag(element) {
  let offsetX, offsetY, isDragging = false;

  element.addEventListener("pointerdown", (e) => {
    isDragging = true;
    offsetX = e.offsetX;
    offsetY = e.offsetY;
    element.setPointerCapture(e.pointerId);
  });

  element.addEventListener("pointermove", (e) => {
    if (!isDragging) return;

    const x = e.clientX - canvas.getBoundingClientRect().left - offsetX;
    const y = e.clientY - canvas.getBoundingClientRect().top - offsetY;

    element.style.left = x + "px";
    element.style.top = y + "px";

    updateNodePosition(element.dataset.id, x, y);
  });

  element.addEventListener("pointerup", () => {
    isDragging = false;
  });
}

function updateNodePosition(id, x, y) {
  const nodes = store.getState().nodes.map(n =>
    n.id === id ? { ...n, x, y } : n
  );
  store.setState({ nodes });
}

/* ==============================
   WORKFLOW EXECUTION
================================= */

function executeWorkflow() {
  const nodes = store.getState().nodes;

  let result = "Start";

  nodes.forEach(node => {
    const plugin = registry.get(node.type);
    if (plugin) {
      result = plugin.execute(result).output;
    }
  });

  alert("Workflow Result:\n\n" + result);
}

/* ==============================
   SERIALIZATION
================================= */

function saveWorkflow() {
  const data = JSON.stringify(store.getState());
  localStorage.setItem("workflow", data);
  alert("Workflow Saved");
}

function loadWorkflow() {
  const data = localStorage.getItem("workflow");
  if (!data) return alert("No saved workflow");

  clearWorkflow();
  const parsed = JSON.parse(data);
  store.setState(parsed);

  parsed.nodes.forEach(renderNode);
}

function clearWorkflow() {
  store.setState({ nodes: [] });
  canvas.innerHTML = "";
}

</script>

</body>
</html>
